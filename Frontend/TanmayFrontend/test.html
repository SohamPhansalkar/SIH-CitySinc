<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Report a Problem - Test Upload</title>
    <link rel="stylesheet" href="report.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #f8f9fa;
      }
    </style>
  </head>

  <body>
    <div class="main">
      <div class="title-block">
        <h1>Test Report Upload</h1>
        <h2>Backend Test: Image + Description</h2>
      </div>
    </div>

    <div class="step-container">
      <div class="card">
        <h3>Upload a Photo</h3>
        <div class="upload-area" id="uploadButton">
          <span>Click to choose a file or drag it here</span>
        </div>
        <input
          type="file"
          id="realButton"
          style="display: none"
          accept="image/*,.jpg,.jpeg,.png"
        />
        <div id="customText">No file chosen</div>
        <p id="photo-warning" class="warning-text">
          Please upload a photo to continue.
        </p>
        <div id="displayImg"></div>
      </div>

      <div class="card">
        <h3>Short Problem Description</h3>
        <div class="form-group">
          <label for="probDescription"
            >Provide a brief description of the issue.</label
          >
          <input
            type="text"
            id="probDescription"
            placeholder="e.g., Large pothole in the middle of the road"
          />
        </div>
      </div>
    </div>

    <div class="page-navigation">
      <button type="button" class="mainButton" id="submitBtn">
        Submit Report
      </button>
    </div>

    <script>
      const APIUrl = "http://localhost:3000"; // Backend URL
      const uploadButton = document.getElementById("uploadButton");
      const realButton = document.getElementById("realButton");
      const customText = document.getElementById("customText");
      const displayImg = document.getElementById("displayImg");
      const photoWarning = document.getElementById("photo-warning");
      const probDescriptionInput = document.getElementById("probDescription");
      let selectedFile = null;

      // Trigger file input on click
      uploadButton.addEventListener("click", () => realButton.click());

      // Show file name and preview
      realButton.addEventListener("change", function () {
        if (this.files && this.files[0]) {
          selectedFile = this.files[0];
          photoWarning.style.display = "none";
          uploadButton.classList.remove("has-error");
          customText.innerText = selectedFile.name;

          const reader = new FileReader();
          reader.onload = () => {
            displayImg.style.backgroundImage = `url(${reader.result})`;
            displayImg.style.display = "block";
          };
          reader.readAsDataURL(selectedFile);
        }
      });

      // Submit report to backend
      document
        .getElementById("submitBtn")
        .addEventListener("click", async () => {
          const description = probDescriptionInput.value.trim();

          if (!selectedFile) {
            photoWarning.style.display = "block";
            uploadButton.classList.add("has-error");
            return;
          }

          const formData = new FormData();
          formData.append("image", selectedFile);
          formData.append("description", description);
          formData.append("category", "Test Category"); // Static test category

          try {
            const res = await fetch(`${APIUrl}/upload`, {
              method: "POST",
              body: formData,
            });
            const data = await res.json();
            console.log("✅ Upload response:", data);
            alert("Upload successful! Check console for details.");
          } catch (err) {
            console.error("❌ Upload failed:", err);
            alert("Upload failed! Check console for details.");
          }
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
